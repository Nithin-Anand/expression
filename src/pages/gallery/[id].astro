---
import { CldImage } from "astro-cloudinary";
import { getCldImageUrl } from "astro-cloudinary/helpers";
import { getCollection } from "astro:content";
import { getAlbumImages } from "../../utils/albums";
import Lightbox from "../../components/Lightbox.astro";

import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const albums = await getCollection("albums");

  const paths = Object.values(albums).map((album) => {
    return {
      params: {
        id: album.id,
      },
      props: {
        album,
      },
    };
  });

  return paths;
}

const { album } = Astro.props;
const rawImages = await getAlbumImages(album.id);

const images = rawImages.map((image) => {
  const lightboxAvif = getCldImageUrl({
    src: image.public_id,
    format: "avif",
    width: 1920,
    quality: "auto",
  });
  const lightboxWebp = getCldImageUrl({
    src: image.public_id,
    format: "webp",
    width: 1920,
    quality: "auto",
  });
  return {
    src: image.public_id, // Use public_id for CldImage
    lightboxAvif: lightboxAvif,
    lightboxWebp: lightboxWebp,
  };
});
---

<BaseLayout pageTitle={album.data.title}>
  <div class="text-center">
    <p class="text-xl my-4">
      {album.data.description}
    </p>

    <div class="mx-auto container my-8 sm:columns-2 md:columns-3 text-center">
      {
        images.map((image) => (
          <CldImage
            src={image.src}
            alt={`Image from ${album.data.title} album`}
            width={600}
            class="rounded mb-4 border border-transparent hover:border-gray-300 transition-all duration-300 ease-in-out hover:shadow-lg cursor-zoom-in"
            loading="lazy"
            data-album-image
            data-lightbox
            data-lightbox-avif={image.lightboxAvif}
            data-lightbox-webp={image.lightboxWebp}
          />
        ))
      }
    </div>

    <p class="text-lg my-4 text-center">
      <a href="/gallery/" class="hover:underline">View other albums</a>
    </p>
  </div>
  <Lightbox />
</BaseLayout>
```
