---
import { CldImage } from "astro-cloudinary";
import { getCollection } from "astro:content";
import "../styles/global.css";
import BaseLayout from "../layouts/BaseLayout.astro";
import { date } from "astro:schema";

// Configuration: Set this to a specific album ID to feature it, or use FEATURED_ALBUM env var
const DEFAULT_FEATURED_ALBUM = "london_street_2025"; // Example default, can be empty string

const featuredAlbumId =
  import.meta.env.FEATURED_ALBUM || DEFAULT_FEATURED_ALBUM;

let allAlbums = await getCollection("albums");
allAlbums = allAlbums
  .filter((item) => item.id !== "portfolio")
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const featuredAlbum = featuredAlbumId
  ? allAlbums.find((album) => album.id === featuredAlbumId)
  : null;
---

<BaseLayout pageTitle="Albums">
  <div class="p-8">
    {
      featuredAlbum && (
        <div class="mx-auto container mb-12 hidden md:block">
          <a
            href={`/gallery/${featuredAlbum.id}`}
            class="group relative block overflow-hidden rounded-xl"
          >
            <div class="aspect-[21/9] w-full relative">
              <CldImage
                src={featuredAlbum.data.cover}
                alt={featuredAlbum.data.title}
                width={1920}
                height={820}
                crop="fill"
                gravity="center"
                class:list={[
                  "object-cover w-full h-full transition-transform duration-700",
                  "group-hover:scale-105",
                ]}
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-80 group-hover:opacity-90 transition-opacity" />
              <div class="absolute bottom-0 left-0 p-8 md:p-12 text-white">
                <span class="inline-block px-3 py-1 mb-4 text-xs font-medium tracking-wider uppercase bg-white/20 backdrop-blur-md rounded-full">
                  Featured Gallery
                </span>
                <h2 class="text-3xl md:text-5xl font-bold mb-2">
                  {featuredAlbum.data.title}
                </h2>
                <p class="text-lg md:text-xl text-white/90 max-w-2xl">
                  {featuredAlbum.data.description}
                </p>
              </div>
            </div>
          </a>
        </div>
      )
    }

    <div
      class="mx-auto container grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
    >
      {
        allAlbums.map((item) => (
          <a
            href={`/gallery/${item.id}`}
            class:list={[
              "group transition-all mb-4 block",
              featuredAlbum?.id === item.id ? "md:hidden" : "",
            ]}
          >
            <CldImage
              src={item.data.cover}
              alt={item.data.title}
              width={720}
              height={480}
              crop="fill"
              gravity="center"
              class:list={[
                "rounded-lg transition-all",
                "group-hover:shadow-lg group-hover:opacity-90",
              ]}
            />
            <div class="mt-4 text-center text-neutral-700">
              <strong class="font-normal">{item.data.title}</strong>
              <p class="text-xs">{item.data.description}</p>
            </div>
          </a>
        ))
      }
    </div>
  </div>
</BaseLayout>
